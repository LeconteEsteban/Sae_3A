<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carrousel Infini avec Swiper.js</title>
    <link
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      #book-popup {
        transition: opacity 0.3s ease-in-out;
        z-index: 1000;
      }

      #book-popup.show {
        display: flex;
        opacity: 1;
      }

      #book-popup.hide {
        opacity: 0;
        pointer-events: none;
      }

      .zoom-hover:hover img {
        transform: scale(1.1);
      }

      #similar-books-container {
        max-height: 400px; /* Ajustez cette valeur selon vos besoins */
        overflow-y: auto;
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-900">
    <div class="w-full py-10 px-10">
      <div class="swiper centered-slide-carousel relative">
        <div class="swiper-wrapper">
          <!-- Les slides seront ajoutés dynamiquement -->
        </div>
        <!-- Flèches de navigation -->
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
      </div>
    </div>

    <!-- Pop-up pour afficher les détails du livre -->
    <div
      id="book-popup"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 relative">
        <div id="first_part_book">
          <button
            id="close-popup"
            class="absolute top-4 right-4 text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times"></i>
          </button>
          <div class="flex flex-col md:flex-row gap-6">
            <div class="w-full md:w-1/3">
              <img
                class="w-full h-auto rounded-lg shadow-md object-cover"
                id="book-cover"
                alt="Couverture du livre"
              />
            </div>
            <div
              class="w-full md:w-2/3 flex flex-col gap-4"
              id="description_left"
            >
              <h2 class="text-3xl font-bold text-[#B3B3B3]" id="book-title">
                Titre du livre
              </h2>
              <a class="text-xl text-[#B3B3B3] hover:underline" id="book-author"
                >Auteur</a
              >
              <div class="flex gap-2 flex-wrap" id="book-genres"></div>
              <div class="flex gap-2 flex-wrap" id="book-awards"></div>
              <div class="bg-[#2C2C2C] p-4 rounded-lg border border-[#B3B3B3]">
                <h3 class="text-xl font-bold text-[#B3B3B3] mb-2">
                  Description
                </h3>
                <p id="book-description" class="text-[#B3B3B3]">
                  Description du livre...
                </p>
              </div>
            </div>
          </div>
          <div
            class="flex flex-col md:flex-row justify-between gap-6 text-gray-400 mt-6"
          >
            <div class="flex gap-2">
              <h3>Nombre de page:</h3>
              <p id="book-page">Nombre de pages</p>
            </div>
            <div class="flex gap-2">
              <h3>Éditeur:</h3>
              <p id="book-publisher">Éditeur :</p>
            </div>
            <div class="flex gap-2">
              <h3>ISBN:</h3>
              <p id="book-isbn">ISBN :</p>
            </div>
          </div>
        </div>
        <div id="second_part_book">
          <!-- Les éléments supplémentaires seront ajoutés dynamiquement -->
          <h2 class="text-3xl font-bold text-[#B3B3B3]" id="title-section">
            Livres similaires
          </h2>
          <div
            id="similar-books-container"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6"
          >
            <!-- Les livres similaires seront ajoutés dynamiquement ici -->
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
      async function fetchBooks() {
        let booksData = [];
        console.log("Debut fetch");

        try {
          const response = await fetch("http://127.0.0.1:8000/books/topbook/30");
          booksData = await response.json();
          console.log("Données récupérées :", booksData); // Affiche les données récupérées
        } catch (error) {
          console.error("Erreur lors de la récupération des données :", error);
        }

        console.log("fin fetch");
        return booksData; // Retourner les données pour les utiliser ailleurs
      }

      async function initializeCarousel() {
        // Attendre que fetchBooks termine et récupérer les données
        const booksData = await fetchBooks();

        // Vérifier si des données ont été récupérées
        if (!booksData || booksData.length === 0) {
          console.error("Aucune donnée récupérée");
          return;
        }

        const swiperWrapper = document.querySelector(".swiper-wrapper");

        // Fonction pour tronquer la description
        function truncateDescription(description, maxLength) {
          if (description.length > maxLength) {
            return description.substring(0, maxLength) + "...";
          }
          return description;
        }

        // Créer les slides avec les données récupérées
        booksData.forEach((book) => {
          const slide = document.createElement("div");
          slide.classList.add(
            "swiper-slide",
            "relative",
            "group",
            "transition-transform",
            "duration-300",
            "zoom-hover"
          );
         

          
          const genres = book.genre_names.slice(0, 2);
          slide.innerHTML = `
            <div class="bg-white shadow-lg rounded-lg p-4 flex flex-col items-center relative w-40 max-w-xs mx-auto">
                <img src="${book.image}" alt="Couverture de ${
            book.title
          }" class="w-32 h-44 object-cover rounded transition-transform duration-300">
                <h3 class="text-lg font-bold text-indigo-600 mt-2 text-center">${
                  book.title
                }</h3>
                <!-- Infos visibles au hover -->
                <div class="absolute inset-0 bg-white bg-opacity-80 flex flex-col text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg p-4">
                    <h3 class="text-lg text-black font-bold mb-1">${
                      book.title
                    }</h3>
                    <p class="text-xs text-black font-semibold mb-1">${
                      book.author_name
                    }</p>
                    <p class="text-xs text-black mb-2">
                    ${book.description ? truncateDescription(book.description.replaceAll("#virgule", ","), 110) : "Pas de description"}
                    </p>

                    <ul class="flex gap-2 mb-3">
                        ${genres.map(genre => `<li class="bg-gray-500 text-white px-2 py-1 text-xs rounded">${genre}</li>`).join('')}
                    </ul>
                    <div class="flex gap-2 mt-auto justify-between w-full">
                        <i class="fas fa-heart text-gray-500 text-2xl cursor-pointer transition-transform duration-200 hover:scale-110 like-button"></i>
                        <i class="fas fa-plus text-gray-500 text-2xl cursor-pointer transition-transform duration-200 hover:scale-110 plus-button"></i>
                        <i class="fas fa-eye text-gray-500 text-2xl cursor-pointer transition-transform duration-200 hover:scale-110 eye-button"></i>
                    </div>
                </div>
            </div>
        `;
          swiperWrapper.appendChild(slide);
        });

        // Initialiser Swiper après avoir ajouté les slides
        var swiper = new Swiper(".centered-slide-carousel", {
          centeredSlides: true,
          loop: true,
          spaceBetween: 10,
          slideToClickedSlide: true,
          navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
          },
          breakpoints: {
            1920: { slidesPerView: 8, spaceBetween: 10 },
            1028: { slidesPerView: 8, spaceBetween: 10 },
            768: { slidesPerView: 8, spaceBetween: 10 },
            480: { slidesPerView: 1, spaceBetween: 10 },
          },
        });
      }

      // Démarrer l'initialisation du carrousel
      initializeCarousel();
    </script>
  </body>
</html>
